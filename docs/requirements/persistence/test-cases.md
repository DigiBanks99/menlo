# Persistence Layer Test Cases

## 1. Schema Verification

| ID         | Test Case                    | Preconditions                                 | Steps                                                                                                                                                                  | Expected Result                                                                                                                                                                         |
| :--------- | :--------------------------- | :-------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **TC-001** | **Verify Schema Separation** | Database initialized with migrations applied. | 1. Connect to the PostgreSQL database using a SQL client.<br>2. Inspect the available schemas.<br>3. Verify tables for each context exist in their respective schemas. | - Schemas `planning`, `budget`, `financial`, `events`, `household` exist.<br>- Tables like `Budgets` are in `budget` schema.<br>- Tables like `PlanningLists` are in `planning` schema. |

## 2. Data Integrity & Auditing

| ID         | Test Case                           | Preconditions                                      | Steps                                                                                                               | Expected Result                                                                                                                                                                |
| :--------- | :---------------------------------- | :------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **TC-002** | **Verify Soft Delete**              | An entity (e.g., a Budget) exists in the database. | 1. Call the API/Repository method to delete the entity.<br>2. Query the database directly for the entity ID.        | - The record still exists in the database.<br>- The `IsDeleted` (or equivalent) column is set to `true`.<br>- The entity is NOT returned by standard repository `Get` queries. |
| **TC-003** | **Verify Audit Fields on Creation** | Authenticated user context available.              | 1. Create a new entity via the API.<br>2. Inspect the database record.                                              | - `CreatedBy` matches the user ID.<br>- `CreatedAt` is a valid UTC timestamp.<br>- `ModifiedBy` matches `CreatedBy`.<br>- `ModifiedAt` matches `CreatedAt`.                    |
| **TC-004** | **Verify Audit Fields on Update**   | Existing entity created by User A.                 | 1. Authenticate as User B (or same user at later time).<br>2. Update the entity.<br>3. Inspect the database record. | - `CreatedBy` remains User A.<br>- `CreatedAt` remains unchanged.<br>- `ModifiedBy` matches User B.<br>- `ModifiedAt` is the new timestamp > `CreatedAt`.                      |

## 3. Infrastructure & Security

| ID         | Test Case                                   | Preconditions                          | Steps                                                                                                                                                                | Expected Result                                                                                                  |
| :--------- | :------------------------------------------ | :------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------- |
| **TC-005** | **Verify Data Persistence Across Restarts** | Application and Database running.      | 1. Create a test record.<br>2. Stop the PostgreSQL container (`docker stop` / `podman stop`).<br>3. Start the PostgreSQL container.<br>4. Query for the test record. | - The record exists and is intact.                                                                               |
| **TC-006** | **Verify SSL Connection**                   | Application configured for SSL.        | 1. Inspect the application logs during startup/connection.<br>2. (Optional) Capture traffic or check connection properties.                                          | - Logs indicate SSL/TLS connection established.<br>- Connection string enforces `SSL Mode=Require` (or similar). |
| **TC-007** | **Verify Migration Application**            | New migration created but not applied. | 1. Run the application (or migration tool).<br>2. Check `__EFMigrationsHistory` table.                                                                               | - The new migration ID appears in the history table.<br>- The schema changes are reflected in the database.      |

## 4. Performance

| ID         | Test Case            | Preconditions                        | Steps                                                           | Expected Result                                                                                  |
| :--------- | :------------------- | :----------------------------------- | :-------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- |
| **TC-008** | **Read Performance** | Database populated with sample data. | 1. Execute a `GetById` operation.<br>2. Measure execution time. | - Operation completes in < 50ms (excluding network latency if remote, but local should be fast). |
